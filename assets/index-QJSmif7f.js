import{jsx as r,jsxs as d,Fragment as O}from"react/jsx-runtime";import{createRoot as A}from"react-dom/client";import{useState as m,useEffect as y,useRef as I,useCallback as L}from"react";import{Link as k,useParams as S,createBrowserRouter as E,RouterProvider as T}from"react-router-dom";import{TailSpin as j}from"react-loader-spinner";import x from"axios";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?c.credentials="include":t.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(t){if(t.ep)return;t.ep=!0;const c=s(t);fetch(t.href,c)}})();const $=()=>r("nav",{className:"text-center text-black text-[1.5em]",children:r("h1",{className:"text-silver",children:"OMDB Search"})}),G=l=>{const{queryValue:e,page:s}=l,[n,t]=m("");return r("div",{className:"grid justify-center items-center",children:r("input",{type:"search",placeholder:"Enter your movie name",onChange:o=>{const{value:i}=o.target;i&&i.length>0?(t(i),e(i),s(1)):(t(""),e(""),s(1))},value:n,"data-testid":"search-input",className:"border-2 border-pink-300 m-4 p-4 rounded focus:outline-none focus:border-pink-500 transition"})})},P="b9bd48a6",w="https://www.omdbapi.com/?apikey=",M="https://picsum.photos/200/300",B=l=>{const e=n=>r("div",{className:"text-center text-white bg-gray-600 m-4 p-4 rounded shadow",children:d(k,{to:`/${n.imdbID}`,className:"text-white hover:underline",children:[r("h3",{className:"font-bold text-lg mb-2",children:n.Title}),r("img",{src:n.Poster!=="N/A"?n.Poster:M,alt:"poster",width:"300",height:"400",className:"mx-auto mb-2 object-cover rounded"}),r("p",{children:r("span",{className:"text-xl font-semibold",children:n.Year})})]})}),s=l.poster.filter((n,t,c)=>t===c.findIndex(o=>o.imdbID===n.imdbID));return s.length>0?r("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 justify-between",children:s.map((n,t)=>s.length===t+1?r("div",{"data-testid":"movie-item",ref:l.letRef,className:"flex",children:e(n)},n.imdbID):r("div",{"data-testid":"movie-item",className:"flex",children:e(n)},n.imdbID))}):null},R=()=>r("div",{className:"flex justify-center items-center min-h-screen",children:r(j,{height:80,width:80,color:"grey",ariaLabel:"loading"})});function C(l,e){const[s,n]=m(!0),[t,c]=m(!1),[o,i]=m([]),[g,b]=m(!1);return y(()=>{i([]),n(!1)},[l]),y(()=>{n(!0),c(!1);let f;return x({method:"GET",url:`${w}${P}&s=${l}&type=movie`,params:{q:l,page:e},cancelToken:new x.CancelToken(u=>f=u)}).then(u=>{i(u.data.Search.filter((h,a)=>u.data.Search.indexOf(h)===a)),b(u.data.totalResults.length>0),n(!1)}).catch(u=>{x.isCancel(u)||(n(!1),c(!0))}),()=>f()},[l,e]),{loading:s,error:t,movies:o,hasMore:g}}const N=()=>{const[l,e]=m(""),[s,n]=m(1),{movies:t,hasMore:c,loading:o,error:i}=C(l,s),g=I(),b=L(h=>{o||(g.current&&g.current.disconnect(),g.current=new IntersectionObserver(a=>{a[0].isIntersecting&&c&&!i&&n(p=>p+1)}),h&&g.current.observe(h))},[o,c,i]);return d(O,{children:[r($,{}),r(G,{queryValue:h=>{e(h)},page:h=>{n(h)}}),o?r(R,{}):null,t.length>0?r(B,{letRef:b,poster:t}):null]})},V=async l=>{let e=x({method:l.method?l.method:{},url:l.url?l.url:{}}).then(s=>e=s).catch(s=>e=s);return e},_=()=>{var c,o,i,g,b,f,u,h;const{id:l}=S(),[e,s]=m([]),[n,t]=m(!1);return y(()=>{async function a(){t(!0);let p=await V({method:"GET",url:`${w}${P}&i=${l}`});t(!1),(p==null?void 0:p.data.Response)==="True"&&Object.keys(p==null?void 0:p.data).length>0&&s(p==null?void 0:p.data)}a()},[l]),!n&&e&&Object.keys(e).length>0?d("div",{"data-testid":"details",children:[d("div",{className:"block m-8 text-center",children:[r(k,{to:"/",className:"text-blue-600 hover:underline text-lg font-bold",children:"Home"}),r("h1",{className:"text-center text-[2rem] text-silver font-bold mt-4 mb-8",children:e==null?void 0:e.Title})]}),r("div",{className:"block m-8 text-center",children:r("img",{src:(e==null?void 0:e.Poster)!=="N/A"?e==null?void 0:e.Poster:M,alt:"Poster",className:"mx-auto bg-black border border-black rounded-lg w-[300px] max-w-full sm:w-[175px]"})}),d("div",{className:"block m-8 text-center",children:[d("p",{children:[r("strong",{children:"Year:"})," ",r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:e==null?void 0:e.Year})]}),d("p",{children:[r("strong",{children:"Rated:"})," ",r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:e==null?void 0:e.Rated})]}),d("p",{children:[r("strong",{children:"Genre:"})," ",((c=e==null?void 0:e.Genre)==null?void 0:c.split(",").length)>0?(o=e==null?void 0:e.Genre)==null?void 0:o.split(",").map(a=>r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:a},a)):r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:e==null?void 0:e.Genre})]}),d("p",{children:[r("strong",{children:"Plot:"})," ",e==null?void 0:e.Plot]}),d("p",{children:[r("strong",{children:"Actors:"})," ",((i=e==null?void 0:e.Actors)==null?void 0:i.split(",").length)>0?(g=e==null?void 0:e.Actors)==null?void 0:g.split(",").map(a=>r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:a},a)):r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:e==null?void 0:e.Actors})]}),d("p",{children:[r("strong",{children:"Director/ Directors:"})," ",((b=e==null?void 0:e.Director)==null?void 0:b.split(",").length)>0?(f=e==null?void 0:e.Director)==null?void 0:f.split(",").map(a=>r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:a},a)):r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:e==null?void 0:e.Director})]}),d("p",{children:[r("strong",{children:"Writer/ Writers:"})," ",((u=e==null?void 0:e.Writer)==null?void 0:u.split(",").length)>0?(h=e==null?void 0:e.Writer)==null?void 0:h.split(",").map(a=>r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:a},a)):r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:e==null?void 0:e.Writer})]}),r("p",{children:d("strong",{children:["Awards: ",r("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:e==null?void 0:e.Awards})]})}),d("p",{children:[r("strong",{children:"OMDB Rating:"}),d("span",{className:"inline-block bg-gray-300 text-black px-4 py-2 rounded-2xl m-2",children:[r("meter",{id:"rating",min:"",low:3,high:9,max:10,value:e==null?void 0:e.imdbRating})," ",`${e==null?void 0:e.imdbRating}`]})]})]})]}):r(R,{})},F=()=>r("h3",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 m-auto text-center",children:"Oops Page Not Found!..."}),W=E([{path:"/",element:r(N,{})},{path:"/:id",element:r(_,{})},{path:"/OMDB_Movie_Search",element:r(N,{})},{path:"*",element:r(F,{})}]);function Y(){return r(T,{router:W,future:{v7_startTransition:!0}})}A(document.getElementById("root")).render(r(Y,{}));
